SchemaVersion: 2018-07-01
Owner: "@10gen/sql-engines-team"
Description: |
  Validate TPC_H normalized queries for scale 1. Note that numeric comparison is not exact in this workload;
  the AssertiveActor only ensures that any two values of numeric type are approximately equal according to a hard-coded limit.
  Adapted from the validate workload in the genny repository.

Clients:
  Default:
    QueryOptions:
      socketTimeoutMS: -1

ActorTemplates:
- TemplateName: ValidateTPCHQueryActorTemplate
  Config:
    Name: &query {^Parameter: {Name: "Query", Default: ""}}
    Type: AssertiveActor
    Database: &db tpch
    Phases:
    - &Nop {Nop: true}
    - Repeat: 1
      Database: validate
      Message: *query
      Expected:
        aggregate: {^Join: {array: ["res_", *query]}}
        pipeline: [{$sort: {num: 1}}]
        cursor: {batchSize: {^Parameter: {Name: "BatchSize", Default: 101}}}
      Actual: {^Parameter: {Name: "Actual", Default: {}}}
    - *Nop

# Note: since the queries are all read-only and we don't care about timing metrics here, we can just run all the queries simultaneously.
# Actors:
# SQL-1469
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 1
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q1_normalized.yml
#           Key: q1_normalized

# SQL-1469
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 2
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q2_normalized.yml
#           Key: q2_normalized

# SQL-1470
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 3
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q3_normalized.yml
#           Key: q3_normalized

# SQL-1470
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 4
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q4_normalized.yml
#           Key: q4_normalized

# SQL-1471
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 5
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q5_normalized.yml
#           Key: q5_normalized

# SQL-1471
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 6
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q6_normalized.yml
#           Key: q6_normalized

# SQL-1472
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 7
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q7_normalized.yml
#           Key: q7_normalized

# SQL-1472
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 8
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q8_normalized.yml
#           Key: q8_normalized

# SQL-1473
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 9
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q9_normalized.yml
#           Key: q9_normalized

# SQL-1473
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 10
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q10_normalized.yml
#           Key: q10_normalized

# SQL-1474
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 11
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q11_normalized.yml
#           Key: q11_normalized

# SQL-1474
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 12
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q12_normalized.yml
#           Key: q12_normalized

# SQL-1475
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 13
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q13_normalized.yml
#           Key: q13_normalized

# SQL-1475
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 14
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q14_normalized.yml
#           Key: q14_normalized

# SQL-1476
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 15
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q15_normalized.yml
#           Key: q15_normalized

# SQL-1476
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 16
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q16_normalized.yml
#           Key: q16_normalized

# SQL-1477
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 17
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q17_normalized.yml
#           Key: q17_normalized

# SQL-1477
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 18
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q18_normalized.yml
#           Key: q18_normalized

# SQL-1478
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 19
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q19_normalized.yml
#           Key: q19_normalized

# SQL-1478
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 20
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q20_normalized.yml
#           Key: q20_normalized

# SQL-1479
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 21
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q21_normalized.yml
#           Key: q21_normalized

# SQL-1479
# - ActorFromTemplate:
#     TemplateName: ValidateTPCHQueryActorTemplate
#     TemplateParameters:
#       Query: 22
#       Actual:
#         LoadConfig:
#           Path: ../atlas_sql/normalized/phase/q22_normalized.yml
#           Key: q22_normalized
