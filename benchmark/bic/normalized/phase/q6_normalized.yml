SchemaVersion: 2018-07-01
Owner: "@10gen/sql-engines-team"
Description: |
  This workload uses the RunCommand actor to issue an aggregation pipeline,
  generated by translating TPC-H query 6 via MongoDB BIC
q6_normalized:
  Repeat: 1
  Database: tpch
  Operations:
    - OperationMetricsName: BIC
      OperationName: RunCommand
      OperationCommand:
        aggregate: lineitem
        pipeline:
          [
            {
              "$match":
                {
                  "$and":
                    [
                      { "l_quantity": { "$lt": 24 } },
                      { "l_discount": { "$lte": 0.071 } },
                      { "l_discount": { "$gte": 0.05 } },
                      { "l_shipdate": { "$lt": ISODate("1995-01-01T00:00:00") } },
                      { "l_shipdate": { "$gte": ISODate("1994-01-01T00:00:00") } },
                    ],
                },
            },
            {
              "$group":
                {
                  "_id": {},
                  "sum(tpch_DOT_lineitem_DOT_l_extendedprice*tpch_DOT_lineitem_DOT_l_discount)":
                    { "$sum": { "$multiply": ["$l_extendedprice", "$l_discount"] } },
                  "sum(tpch_DOT_lineitem_DOT_l_extendedprice*tpch_DOT_lineitem_DOT_l_discount)_count":
                    {
                      "$sum":
                        {
                          "$cond":
                            {
                              "if":
                                {
                                  "$lte":
                                    [
                                      {
                                        "$multiply": ["$l_extendedprice", "$l_discount"],
                                      },
                                      null,
                                    ],
                                },
                              "then": 0,
                              "else": 1,
                            },
                        },
                    },
                },
            },
            {
              "$project":
                {
                  "tpch_DOT_sum(tpch_DOT_lineitem_DOT_l_extendedprice*tpch_DOT_lineitem_DOT_l_discount)":
                    {
                      "$cond":
                        {
                          "if": "$sum(tpch_DOT_lineitem_DOT_l_extendedprice*tpch_DOT_lineitem_DOT_l_discount)_count",
                          "then": "$sum(tpch_DOT_lineitem_DOT_l_extendedprice*tpch_DOT_lineitem_DOT_l_discount)",
                          "else": { "$literal": null },
                        },
                    },
                  "_id": 0,
                },
            },
          ]
        cursor: {}
