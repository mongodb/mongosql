catalog_data:
  foo:
    bar:
      - {'_id': 0, 'a': {'$numberInt': '1'}, 'b': {'$numberInt': '2'}, 'c': {'$numberInt': '3'}}

tests:
  - description: addition with more than 2 operands
    current_db: foo
    query: "SELECT VALUE {'n': a::!INT + b::!INT + c::!INT} FROM bar AS bar"
    skip_reason: "SQL-609"
    translation_target_db: foo
    translation_target_coll: bar
    translation:
      - {'$project': {'_id': 0, 'bar': '$$ROOT'}}
      - {'$project': {'_id': 0, 'bar': '$bar'}}
      - {'$project': {'_id': 0, '__bot': {'n': {'$add': ['$bar.a', '$bar.b', '$bar.c']}}}}
      - { '$replaceWith': { '$unsetField': { 'field': '__bot', 'input':
           { '$setField': { 'field': '' , 'input': '$$ROOT', 'value': '$__bot' }
        }}}}
    result:
      - {'': {'n': {'$numberInt': '6'}}}

  - description: addition with unit operands
    current_db: foo
    query: "SELECT VALUE {'n': a::INT + 0 + 0.0} FROM bar AS bar"
    translation_target_db: foo
    translation_target_coll: bar
    translation:
      - {'$project': {'_id': 0, 'bar': '$$ROOT'}}
      - {'$project': {'_id': 0, 'bar': '$bar'}}
      - {'$project': {'_id': 0, '__bot': {'n': {'$convert': {'input': '$bar.a', 'to': 'int', 'onNull': {'$literal': null}, 'onError': {'$literal': null}}}}}}
      - { '$replaceWith': { '$unsetField': { 'field': '__bot', 'input':
           { '$setField': { 'field': '' , 'input': '$$ROOT', 'value': '$__bot' }
        }}}}
    result:
      - {'': {'n': {'$numberInt': '1'}}}

  - description: subtraction with more than 2 operands
    current_db: foo
    query: "SELECT VALUE {'n': a::!INT - b::!INT - c::!INT} FROM bar AS bar"
    translation_target_db: foo
    translation_target_coll: bar
    translation:
      - {'$project': {'_id': 0, 'bar': '$$ROOT'}}
      - {'$project': {'_id': 0, 'bar': '$bar'}}
      - {'$project': {'_id': 0, '__bot': {'n': {'$subtract': [{'$subtract': ['$bar.a', '$bar.b']}, '$bar.c']}}}}
      - { '$replaceWith': { '$unsetField': { 'field': '__bot', 'input':
           { '$setField': { 'field': '' , 'input': '$$ROOT', 'value': '$__bot' }
        }}}}
    result:
      - {'': {'n': {'$numberInt': '-4'}}}

  - description: multiplication with more than 2 operands
    current_db: foo
    query: "SELECT VALUE {'n': a::!INT * b::!INT * c::!INT} FROM bar AS bar"
    skip_reason: "SQL-609"
    translation_target_db: foo
    translation_target_coll: bar
    translation:
      - {'$project': {'_id': 0, 'bar': '$$ROOT'}}
      - {'$project': {'_id': 0, 'bar': '$bar'}}
      - {'$project': {'_id': 0, '__bot': {'n': {'$multiply': ['$bar.a', '$bar.b', '$bar.c']}}}}
      - { '$replaceWith': { '$unsetField': { 'field': '__bot', 'input':
           { '$setField': { 'field': '' , 'input': '$$ROOT', 'value': '$__bot' }
        }}}}
    result:
      - {'': {'n': {'$numberInt': '6'}}}

  - description: multiplication with unit operands
    current_db: foo
    query: "SELECT VALUE {'n': a::INT * 1 * 1.0} FROM bar AS bar"
    translation_target_db: foo
    translation_target_coll: bar
    translation:
      - {'$project': {'_id': 0, 'bar': '$$ROOT'}}
      - {'$project': {'_id': 0, 'bar': '$bar'}}
      - {'$project': {'_id': 0, '__bot': {'n': {'$convert': {'input': '$bar.a', 'to': 'int', 'onNull': {'$literal': null}, 'onError': {'$literal': null}}}}}}
      - { '$replaceWith': { '$unsetField': { 'field': '__bot', 'input':
           { '$setField': { 'field': '' , 'input': '$$ROOT', 'value': '$__bot' }
        }}}}
    result:
      - {'': {'n': {'$numberInt': '1'}}}

  - description: division with more than 2 operands
    current_db: foo
    query: "SELECT VALUE {'n': a::!INT / b::!INT / c::!INT} FROM bar AS bar"
    skip_reason: "SQL-362 truncate integer division"
    translation_target_db: foo
    translation_target_coll: bar
    translation:
      - {'$project': {'_id': 0, 'bar': '$$ROOT'}}
      - {'$project': {'_id': 0, 'bar': '$bar'}}
      - {'$project': {'_id': 0, '__bot': {'n': {'$sqlDivide': {'dividend': {'$sqlDivide': {'dividend': '$bar.a', 'divisor': '$bar.b', 'onError': {'$literal': null}}}, 'divisor': '$bar.c', 'onError': {'$literal': null}}}}}}
      - { '$replaceWith': { '$unsetField': { 'field': '__bot', 'input':
           { '$setField': { 'field': '' , 'input': '$$ROOT', 'value': '$__bot' }
        }}}}
    result:
      - {'': {'n': {'$numberInt': '0'}}}
