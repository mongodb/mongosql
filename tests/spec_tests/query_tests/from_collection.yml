catalog_data:
  mydb:
    foo:
      - {'_id': 0, 'a': 1}
  otherdb:
    foo:
      - {'_id': 0, 'b': 1}

tests:
  - description: reference collection in current db by fully qualified name
    current_db: mydb
    query: "SELECT * FROM mydb.foo AS foo"
    translation_target_db: mydb
    translation_target_coll: foo
    translation:
      - {'$project': {'_id': 0, 'foo': '$$ROOT'}}
      - {'$project': {'_id': 0, 'foo': '$foo'}}
    result:
      - {'foo': {'_id': 0, 'a': 1}}

  - description: reference collection in current db by unqualified name
    current_db: mydb
    query: "SELECT * FROM foo AS foo"
    translation_target_db: mydb
    translation_target_coll: foo
    translation:
      - {'$project': {'_id': 0, 'foo': '$$ROOT'}}
      - {'$project': {'_id': 0, 'foo': '$foo'}}
    result:
      - {'foo': {'_id': 0, 'a': 1}}

  - description: reference collection in other db by fully qualified name
    current_db: mydb
    query: "SELECT * FROM otherdb.foo AS foo"
    translation_target_db: otherdb
    translation_target_coll: foo
    translation:
      - {'$project': {'_id': 0, 'foo': '$$ROOT'}}
      - {'$project': {'_id': 0, 'foo': '$foo'}}
    result:
      - {'foo': {'_id': 0, 'b': 1}}

  - description: collection references may have at most two parts
    query: "SELECT * FROM a.b.c"
    should_compile: false
    parse_error: "collection datasources can only have database qualification, found: a.b.c"
