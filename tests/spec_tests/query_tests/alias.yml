catalog_environment:
    {
        'db': {
            'foo': [
                {'a': 1, 'b': 2}
            ]
        }
    }

tests:
  - description: Cannot use duplicate implicit aliases for fields
    query: "SELECT a, a FROM [{'a': 1}]"
    error: "error: alias 'a' used two times"

  - description: Cannot use duplicate explicit aliases for fields
    query: "SELECT a AS alias, a AS alias FROM [{'a': 1}]"
    error: "error: alias 'alias' used two times"

  - description: Cannot use duplicate generated aliases for fields
    query: "SELECT a AS _2, a+1 FROM [{'a': 1}]"
    error: "error: alias '_2' used two times"

  - description: Can use different aliases for same field
    query: "SELECT a AS a1, a AS a2 FROM [{'a': 1}]"
    result:
      - {"a1": 1, "a2": 1}

  - description: Cannot use duplicate implicit aliases for collections
    query: "SELECT * FROM foo, foo"
    error: "error: alias 'foo' used two times"

  - description: Cannot use duplicate explicit aliases for collections
    query: "SELECT * FROM foo AS alias, foo AS alias"
    error: "error: alias 'alias' used two times"

  - description: Cannot use duplicate generated aliases for FROM arrays
    query: "SELECT * FROM [{'a': 1}], [{'b': 2}] AS _2"
    error: "error: alias '_2' used two times"

  - description: Can use different alias for same collection
    current_db: db
    query: "SELECT * FROM foo AS foo1, foo AS foo2"
    result:
      - {"foo1": {"a": 1, "b": 2}, "foo2": {"a": 1, "b": 2}}

  - description: Can use duplicate aliases on both sides of UNION
    query: "SELECT a, b AS c FROM foo AS foo UNION SELECT a, b AS c FROM foo AS foo"
    result:
      - {"a": 1, "c": 2}

  - description: Can use duplicate aliases on both sides of UNION JOIN
    query: "SELECT * FROM foo AS foo UNION ALL JOIN foo AS foo"
    result:
      - {"a": 1, "b": 2}
      - {"a": 1, "b": 2}
